# 服务器部署

## 前端部署

## 后端部署

运行/代码/api.py

## 数据库部署

1、数据源部署

数据库采用neo4j图形数据库，自行官网下载

```http
https://neo4j.com/
```

2、数据导入

后端代码中依次运行/代码/construct/ECG_construction.py、/代码/construct/TEC_construction.py、/代码/construct/database_extend.py进行数据导入

# 接口说明

## 历史案例查询

### 输入：

路径：/findByLine

方法：GET

参数：line=线路名称（精准匹配）如：大甲线

示例：

```http
localhost:5000/findByLine?line=大甲线
```

### 输出：

返回结果：

{
	"links":
	[
		{
			"source":源节点id,
			"target":目标节点id
		},
		...
	],
	"nodes":
	[
		{
			"id":节点id,
			节点其他属性
		},
		...
	]
}

示例：

```json
{
    "links": [
        {
            "source": 83184,
            "target": 83185
        },
        {
            "source": 83183,
            "target": 83184
        },
        {
            "source": 83182,
            "target": 83183
        }
    ],
    "nodes": [
        {
            "estimatedPowerDeliveryTime": "2022-06-02 02:00",
            "faultEndTime":NaN,
            "faultLevel":NaN,
            "faultStartTime": "2022-06-01 19:51",
            "id": 83185,
            "isChanged":NaN,
            "isDefective": "否",
            "isLowVoltageEquipment": "否",
            "landLossSituation": "完全失地",
            "name": "A54A21AD-7C1F-4D94-816F-93840FF65DCB",
            "powerOutageCommonVariable": 23.0,
            "powerOutageSpecificVariable": 7.0,
            "powerOutageStartTime": "2022-06-01 19:52",
            "powerSupplyRestoreTime": "2022-06-01 21:07",
            "protectionActionSituation": "无",
            "reclosingSituation": "无",
            "time": "2022-06-01"
        },
        {
            "estimatedPowerDeliveryTime": "2022-12-26 03:00",
            "faultEndTime": "2022-12-25 21:56",
            "faultLevel":NaN,
            "faultStartTime": "2022-12-25 20:49",
            "id": 83184,
            "isChanged": "否",
            "isDefective": "否",
            "isLowVoltageEquipment": "否",
            "landLossSituation": "无",
            "name": "C6B72B6B-015B-45C3-A22B-06A7A510459B",
            "powerOutageCommonVariable": 4.0,
            "powerOutageSpecificVariable": 5.0,
            "powerOutageStartTime": "2022-12-25 20:53",
            "powerSupplyRestoreTime": "2022-12-25 21:56",
            "protectionActionSituation": "无",
            "reclosingSituation": "无",
            "time": "2022-12-25"
        }
    ]
}
```

## 关联线路推荐

### 输入：

路径：/neighbors

方法：GET

参数：line=线路名称（精准匹配）如：大甲线

示例：

```http
localhost:5000/neighbors?line=东吉支
```

### 输出：

返回结果：

[
	{
		"name":一阶邻居线路名称（不包括自身）
	},
	...
]

示例：

```json
[
    {
        "name": "杉洋线"
    },
    {
        "name": "小甲线"
    },
    {
        "name": "大甲线"
    },
    {
        "name": "杉洋变"
    }
]
```

## FDM预测

### 输入：

路径：/FDMpredict

方法：GET

参数：line=线路名称（精准匹配）如：大甲线，year=四位数年份，month=两位数月份，day=两位数日期

示例：

```http
localhost:5000/FDMpredict?line=东吉支&year=2021&month=08&day=23
```

### 输出：

返回结果：

[
	{
		"equipment":故障设备预测,
		"reason":故障原因预测,
		"score":该预测得分
	},
	...
]

示例：

```json
[
    {
        "equipment": "无间隙避雷器",
        "reason": "本体击穿",
        "score": 7.5512
    },
    {
        "equipment": "用户设备",
        "reason": "",
        "score": 3.2614
    },
    {
        "equipment": "裸导线",
        "reason": "短路、接地",
        "score": 3.1459
    },
    {
        "equipment": "柱上开关",
        "reason": "开关跳闸（原因不清）",
        "score": 3.0737
    },
    {
        "equipment": "绝缘导线",
        "reason": "短路、接地",
        "score": 2.32
    }
]
```

## 单类型知识图谱

### 输入：

路径：/graph/类型名称

方法：GET

参数：无

示例：

```http
localhost:5000/graph/FaultyEquipment
```

### 输出：

返回结果：

[
	{
		"name":...
	},
	...
]

示例：

```json
[
    {
        "name": "裸导线"
    },
    {
        "name": "柱上开关"
    },
    {
        "name": "隔离刀闸"
    },
    {
        "name": "变压器"
    }
]
```

## 双类型知识图谱

### 输入：

路径：/graph/类型名称1/类型名称2

方法：GET

参数：无

示例：

```http
localhost:5000/graph/FaultyEquipment/FaultDescriptionType
```

### 输出：

返回结果：

{
	"links":
	[
		{
			"source":源节点id,
			"target":目标节点id
		},
		...
	],
	"类型名称1":
	[
		{
			"id":节点id,
			"name":...
		},
		...
	],
	"类型名称2":
	[
		{
			"id":节点id,
			"name":...
		},
		...
	]
}

示例：

```json
{
    "FaultDescriptionType": [
        {
            "id": 149272,
            "name": "其他"
        },
        {
            "id": 149277,
            "name": "本体烧毁"
        },
        {
            "id": 149281,
            "name": "二次回路故障"
        }
    ],
    "FaultyEquipment": [
        {
            "id": 149270,
            "name": "裸导线"
        },
        {
            "id": 149276,
            "name": "柱上开关"
        }
    ],
    "links": [
        {
            "source": 149270,
            "target": 149272
        },
        {
            "source": 149270,
            "target": 149283
        }
    ]
}
```

## 四类型知识图谱

### 输入：

路径：/graph/allType

方法：GET

参数：无

示例：

```http
localhost:5000/graph/allType
```

### 输出：

返回结果：

{
	"links":[
		{
			"source":源节点id,
			"target":目标节点id
		},
		...
	],
	"FaultDescriptionType":
	[
		{
			"id":节点id,
			"name":...
		},
	...
	],
	"FaultDescription":
	[
		{
			"id":节点id,
			"name":...
		},
	...
	],
	"FaultyEquipmentType":
	[
		{
			"id":节点id,
			"name":...
		},
	...
	],
	"FaultyEquipment":
	[
		{
			"id":节点id,
			"name":...
		},
	...
	]
}

```json
{
    "FaultDescription": [
        {
            "id": 149273,
            "name": "不属于以上几类的，在备注中输入故障现象"
        },
        {
            "id": 149278,
            "name": "短路、绝缘下降等原因造成柱开烧毁"
        },
        {
            "id": 149282,
            "name": "二次回路或自动化设备异常引起的停电"
        }
    ],
    "FaultDescriptionType": [
        {
            "id": 149272,
            "name": "其他"
        },
        {
            "id": 149277,
            "name": "本体烧毁"
        }
    ],
    "FaultyEquipment": [
        {
            "id": 149270,
            "name": "裸导线"
        }
    ],
    "FaultyEquipmentType": [
        {
            "id": 149271,
            "name": "架空类"
        },
        {
            "id": 149322,
            "name": "电缆类"
        },
    ],
    "links": [
        {
            "source": 149273,
            "target": 149272
        },
        {
            "source": 149278,
            "target": 149277
        },
        {
            "source": 149282,
            "target": 149281
        }
   	]
}
```

## 相似事件推荐

### 输入：

路径：/recommend

方法：GET

参数：line=线路名称（精准匹配）如：大甲线，year=四位数年份，month=两位数月份，day=两位数日期

示例：

```http
localhost:5000/recommend?year=2021&month=08&day=21&line=大甲线
```

### 输出：

返回结果：

[
	{
		"各个字段":...,
		...
	},
	...(共五个结果，按顺序为日期最近的五个结果)
]

示例：

```json
[
    {
        "estimatedPowerDeliveryTime": "2021-08-23 10:00",
        "faultEndTime": "2021-08-23 04:10",
        "faultLevel":NaN,
        "faultStartTime": "2021-08-23 03:58",
        "isChanged": "否",
        "isDefective": "否",
        "isLowVoltageEquipment": "否",
        "landLossSituation": "无",
        "name": "3ED06F96-E5E4-4201-B78C-12D8FEE867CD",
        "powerOutageCommonVariable": 12.0,
        "powerOutageSpecificVariable": 1.0,
        "powerOutageStartTime": "2021-08-23 03:59",
        "powerSupplyRestoreTime": "2021-08-23 04:08",
        "protectionActionSituation": "无",
        "reclosingSituation": "无",
        "time": "2021-08-23"
    },
    {
        "estimatedPowerDeliveryTime": "2021-08-18 09:00:00",
        "faultEndTime": "2021-08-18 03:10:47",
        "faultLevel":NaN,
        "faultStartTime": "2021-08-17 18:49:37",
        "isChanged": "否",
        "isDefective": "否",
        "isLowVoltageEquipment": "否",
        "landLossSituation": "无",
        "name": "FA754132-0B2C-4172-86D5-58F2FDC4E49F",
        "powerOutageCommonVariable": 14.0,
        "powerOutageSpecificVariable": 3.0,
        "powerOutageStartTime": "2021-08-17 18:49:50",
        "powerSupplyRestoreTime": "2021-08-18 02:58:30",
        "protectionActionSituation": "无",
        "reclosingSituation": "无",
        "time": "2021-08-17"
    },
    {
        "estimatedPowerDeliveryTime": "2021-08-18 00:00:00",
        "faultEndTime": "2021-08-18 03:10:40",
        "faultLevel":NaN,
        "faultStartTime": "2021-08-17 17:15:27",
        "isChanged": "否",
        "isDefective": "否",
        "isLowVoltageEquipment": "否",
        "landLossSituation": "无",
        "name": "36856457-CC3E-4C7B-9231-40E0AAF78D35",
        "powerOutageCommonVariable": 13.0,
        "powerOutageSpecificVariable":NaN,
        "powerOutageStartTime": "2021-08-17 17:16:17",
        "powerSupplyRestoreTime": "2021-08-17 18:04:27",
        "protectionActionSituation": "无",
        "reclosingSituation": "无",
        "time": "2021-08-17"
    },
    {
        "estimatedPowerDeliveryTime": "2021-08-17 17:00:00",
        "faultEndTime": "2021-08-17 15:00:11",
        "faultLevel":NaN,
        "faultStartTime": "2021-08-16 20:21:49",
        "isChanged": "否",
        "isDefective": "否",
        "isLowVoltageEquipment": "否",
        "landLossSituation": "无",
        "name": "231918EF-7B51-42C0-87A6-9EB09A82F641",
        "powerOutageCommonVariable": 12.0,
        "powerOutageSpecificVariable": 1.0,
        "powerOutageStartTime": "2021-08-16 20:22:07",
        "powerSupplyRestoreTime": "2021-08-17 15:07:29",
        "protectionActionSituation": "无",
        "reclosingSituation": "无",
        "time": "2021-08-16"
    },
    {
        "estimatedPowerDeliveryTime": "2021-08-15 00:00:00",
        "faultEndTime": "2021-08-14 18:04:41",
        "faultLevel":NaN,
        "faultStartTime": "2021-08-14 17:34:38",
        "isChanged": "否",
        "isDefective": "否",
        "isLowVoltageEquipment": "否",
        "landLossSituation": "无",
        "name": "3817134A-D3D4-4524-A017-1E668006F598",
        "powerOutageCommonVariable": 14.0,
        "powerOutageSpecificVariable": 3.0,
        "powerOutageStartTime": "2021-08-14 17:36:10",
        "powerSupplyRestoreTime": "2021-08-14 18:07:29",
        "protectionActionSituation": "无",
        "reclosingSituation": "无",
        "time": "2021-08-14"
    }
]
```

